{% extends "auctions/layout.html" %}

{% block body %}
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <h2>{{ listing.title }}</h2>

    {% if listing.image %}
        <img src="{{ listing.image }}" alt="{{ listing.title }}" style="max-height: 400px; max-width: 600px;">
    {% endif %}

    <p>{{ listing.description }}</p>

    <h4>Current Bid: ${{ current_bid }}</h4>

    {% if user.is_authenticated %}
        {% if user in listing.watchers.all %}
            <a href="{% url 'watchlist' listing.id %}" class="btn btn-danger">Remove from Watchlist</a>
        {% else %}
            <a href="{% url 'watchlist' listing.id %}" class="btn btn-primary">Add to Watchlist</a>
        {% endif %}

        <form action="{% url 'listing_page' listing.id %}" method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label for="bid_amount">Place Bid:</label>
                <input type.html"number" name="bid_amount" min="{{ current_bid }}" step="0.01" class="form-control" placeholder="Your Bid">
                <input type="submit" value="Place Bid" class="btn btn-success mt-2">
            </div>
        </form>

        {% if listing.is_active %}
            {% if user.is_authenticated and user == listing.creator %}
                <h4>Admin: Close this Auction</h4>
                <p>Warning: This action cannot be undone.</p>

                <form action="{% url 'close_auction' listing.id %}" method="POST">
                    {% csrf_token %}
                    <input type="submit" value="Close Auction" class="btn btn-danger">
                </form>
            {% endif %}
        {% endif %}    

    {% endif %}

    <hr>

{% endblock %}